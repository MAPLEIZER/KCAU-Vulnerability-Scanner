// Google Sheets API configuration
const CLIENT_ID = '103861745138294387924';
const API_KEY = '74f139aca54dda2a5a85e5ec082028ca6b93dd2a';
const SPREADSHEET_ID = 'your-spreadsheet-id-here';
const SCOPES = 'https://www.googleapis.com/auth/spreadsheets';
const DISCOVERY_DOCS = ['https://sheets.googleapis.com/$discovery/rest?version=v4'];

// Nmap API configuration
const NMAP_API_KEY = prompt('o3prpwkpwmjfaika104lh3hmmlpp5inbgsqubtckkbhce2a2');

// Google Sheets API authorization
function authorizeSheetsApi(callback) {
  gapi.load('client:auth2', () => {
    gapi.client.init({
      apiKey: API_KEY,
      clientId: CLIENT_ID,
      discoveryDocs: DISCOVERY_DOCS,
      scope: SCOPES,
    }).then(() => {
      gapi.auth2.getAuthInstance().signIn().then(() => {
        callback();
      });
    });
  });
}

// Nmap API function
async function scanHost(ip) {
  const url = `https://api.nmap.online/v1/scan/${ip}`;
  const options = {
    headers: {
      Authorization: `Bearer ${NMAP_API_KEY}`
    }
  };
  const response = await fetch(url, options);
  const data = await response.json();
  return data;
}

// Event listener for the button
document.getElementById('scanBtn').addEventListener('click', () => {
  const ip = document.getElementById('ipInput').value;
  scanHost(ip).then(data => {
    const rows = [
      [ip, data.status, data.start_time, data.end_time]
    ];
    gapi.client.sheets.spreadsheets.values.append({
      spreadsheetId: SPREADSHEET_ID,
      range: 'Sheet1!A:B',
      valueInputOption: 'USER_ENTERED',
      resource: {
        values: rows
      },
    }).then(() => {
      alert('Data added to Google Sheets!');
    }).catch(err => {
      console.error('Error:', err);
    });
  }).catch(err => {
    console.error('Error:', err);
    alert('There was an error scanning the host. Please check the IP address and try again.');
  });
});

// Load the Google Sheets API
function loadSheetsApi() {
  gapi.client.load('sheets', 'v4', () => {
    console.log('Sheets API loaded.');
  });
}

// Initialize the API client and authorize the Sheets API
function initClient() {
  gapi.client.init({
    apiKey: API_KEY,
    clientId: CLIENT_ID,
    discoveryDocs: DISCOVERY_DOCS,
    scope: SCOPES,
  }).then(() => {
    authorizeSheetsApi(loadSheetsApi);
  });
}

// Load the API client and auth2 library
gapi.load('client:auth2', initClient);
